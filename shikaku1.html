<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天秤とみかんのドロップ</title>
    <style>
        h2 {
            font-size: 50px; /* 文字サイズを大きくする */
            text-align: center;
        }
        #background {
            width: 750px;
            height: 470px;
            margin: 100px auto;
            background-image: url('images/tenbin1.png'); /* 天秤の画像 */
            background-size: cover;
            position: relative;
        }
        #dropZone {
            width: 300px;
            height: 200px;
            position: absolute;
            top: 20%;
            right: 5%;
            transform: translateY(-50%);
            background-color: rgba(255, 255, 255, 0.5); /* 少し透明な白で背景をつける */
            border-radius: 10px;
            text-align: center;
            line-height: 150px;
            display: flex; /* 横並びにする */
            justify-content: center; /* 横方向に中央寄せ */
            align-items: center; /* 縦方向に中央寄せ */
            gap: 10px; /* みかん同士の間隔を設定 */
            transition: background-color 0.3s ease, border-color 0.3s ease; /* ドラッグ時のエフェクト */
        }
        .draggable {
            width: 100px;
            height: 100px;
            margin: 10px;
            cursor: grab;
            position: relative;
        }
        #imageContainer {
            text-align: center;
            margin-top: 20px;
        }
        .dropped-mikan {
            width: 100px;
            height: 100px;
            display: inline-block;
        }
        /* ドラッグ中のハイライトエフェクト */
        #dropZone.dragover {
            background-color: rgba(255, 255, 200, 0.8); /* ドラッグ中は色を変更 */
            border-color: #ffcc00; /* 枠の色を変更 */
        }        
    </style>
</head>
<body>

    <h2>天秤がつりあうようにみかんを右の皿に置いてね</h2>
    <div id="background">
        <div id="dropZone"></div>
    </div>

    <div id="imageContainer">
        <img id="mikan" src="images/mikan.png" alt="みかん" class="draggable" draggable="true">
    </div>

</body>
<script>
// みかんをドロップするカウント
let dropCount = 0;
const maxDropCount = 3; // ドロップできるみかんの最大数

// ドラッグできるみかんの画像を設定
const mikanImage = document.getElementById('mikan');
const dropZone = document.getElementById('dropZone');

// ドラッグイベント用関数
function handleDragStart(e) {
    e.dataTransfer.setData('text/plain', e.target.id);
}

function handleDragOver(e) {
    e.preventDefault();
    dropZone.classList.add('dragover'); // ドラッグ中のハイライト
}

function handleDragLeave(e) {
    dropZone.classList.remove('dragover'); // ドラッグが離れたら元に戻す
}

function handleDrop(e) {
    e.preventDefault();
    dropZone.classList.remove('dragover'); // ドロップ後にハイライトを消す

    // みかんの数が最大数に達していないか確認
    if (dropCount >= maxDropCount) {
        return; // これ以上みかんを追加しない
    }

    // みかんの画像をドロップゾーン内に追加
    const imageId = e.dataTransfer.getData('text/plain');
    if (imageId === 'mikan') {
        dropCount++;

        const droppedMikan = document.createElement('img');
        droppedMikan.src = 'images/mikan.png'; // みかんの画像を設定
        droppedMikan.classList.add('dropped-mikan');
        dropZone.appendChild(droppedMikan);

        // みかんを3つドロップしたら天秤の画像を変更
        if (dropCount === 3) {
            document.getElementById('background').style.backgroundImage = "url('images/tenbin2.png')"; // 天秤が釣り合った状態の画像に変更
        }
    }
}

// タッチデバイス対応の関数
function handleTouchStart(e) {
    e.preventDefault();
    const touch = e.targetTouches[0];
    const img = e.target;
    img.style.position = 'absolute';
    img.style.left = touch.pageX - img.offsetWidth / 2 + 'px';
    img.style.top = touch.pageY - img.offsetHeight / 2 + 'px';
}

function handleTouchMove(e) {
    e.preventDefault();
    const touch = e.targetTouches[0];
    const img = e.target;
    img.style.left = touch.pageX - img.offsetWidth / 2 + 'px';
    img.style.top = touch.pageY - img.offsetHeight / 2 + 'px';
}

function handleTouchEnd(e) {
    e.preventDefault();
    
    if (dropCount >= maxDropCount) {
        return; // これ以上みかんを追加しない
    }

    const img = e.target;
    const dropRect = dropZone.getBoundingClientRect();
    const imgRect = img.getBoundingClientRect();

    // ドロップゾーン内にタッチ終了したかを判定
    if (
        imgRect.left >= dropRect.left &&
        imgRect.right <= dropRect.right &&
        imgRect.top >= dropRect.top &&
        imgRect.bottom <= dropRect.bottom
    ) {
        const droppedMikan = document.createElement('img');
        droppedMikan.src = img.src;
        droppedMikan.classList.add('dropped-mikan');
        dropZone.appendChild(droppedMikan); // ドロップ成功時に画像を追加

        dropCount++;
        if (dropCount === 3) {
            document.getElementById('background').style.backgroundImage = "url('images/tenbin2.png')"; // 天秤が釣り合った状態の画像に変更
        }
    }

    // 画像の位置を元に戻す
    img.style.position = 'relative';
    img.style.left = '0px';
    img.style.top = '0px';
}

// イベントリスナーを追加
mikanImage.addEventListener('dragstart', handleDragStart);

// タッチイベントのリスナー追加
mikanImage.addEventListener('touchstart', handleTouchStart);
mikanImage.addEventListener('touchmove', handleTouchMove);
mikanImage.addEventListener('touchend', handleTouchEnd);

// ドロップゾーンに対するイベント設定
dropZone.addEventListener('dragover', handleDragOver);
dropZone.addEventListener('dragleave', handleDragLeave);
dropZone.addEventListener('drop', handleDrop);

</script>
</html>
